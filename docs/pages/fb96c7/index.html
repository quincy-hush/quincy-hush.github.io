<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>实现Implementations | 1ms Faster</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/more.png">
    <meta name="description" content="Software performace profile/analysis/optimization">
    <meta name="keywords" content="optimization, analysis, profile, performance, latency, throughput, metrics, linux, cache, CPU, architecture">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.e5fe63c7.css" as="style"><link rel="preload" href="/assets/js/app.3f18542a.js" as="script"><link rel="preload" href="/assets/js/2.0eed2333.js" as="script"><link rel="preload" href="/assets/js/3.1c18827c.js" as="script"><link rel="preload" href="/assets/js/29.93771d6e.js" as="script"><link rel="prefetch" href="/assets/js/10.6521a7ab.js"><link rel="prefetch" href="/assets/js/11.b5dffaf5.js"><link rel="prefetch" href="/assets/js/12.8c885184.js"><link rel="prefetch" href="/assets/js/13.aeca5c08.js"><link rel="prefetch" href="/assets/js/14.531e8cc9.js"><link rel="prefetch" href="/assets/js/15.e1d4e55a.js"><link rel="prefetch" href="/assets/js/16.b5733294.js"><link rel="prefetch" href="/assets/js/17.6ebbc744.js"><link rel="prefetch" href="/assets/js/18.70850c97.js"><link rel="prefetch" href="/assets/js/19.58d5cecb.js"><link rel="prefetch" href="/assets/js/20.8bcfd87e.js"><link rel="prefetch" href="/assets/js/21.b607bcc6.js"><link rel="prefetch" href="/assets/js/22.bbfb5196.js"><link rel="prefetch" href="/assets/js/23.ca136498.js"><link rel="prefetch" href="/assets/js/24.c1071b43.js"><link rel="prefetch" href="/assets/js/25.95ea2f27.js"><link rel="prefetch" href="/assets/js/26.5762bf58.js"><link rel="prefetch" href="/assets/js/27.e32f1527.js"><link rel="prefetch" href="/assets/js/28.cdc1ea65.js"><link rel="prefetch" href="/assets/js/30.825aa915.js"><link rel="prefetch" href="/assets/js/31.e57c17c1.js"><link rel="prefetch" href="/assets/js/32.2cb1de9c.js"><link rel="prefetch" href="/assets/js/33.d25a33b3.js"><link rel="prefetch" href="/assets/js/34.65ebcddc.js"><link rel="prefetch" href="/assets/js/35.ddecc1a0.js"><link rel="prefetch" href="/assets/js/36.09debf08.js"><link rel="prefetch" href="/assets/js/37.4c887612.js"><link rel="prefetch" href="/assets/js/38.1185428b.js"><link rel="prefetch" href="/assets/js/39.158e04ca.js"><link rel="prefetch" href="/assets/js/4.a222ae79.js"><link rel="prefetch" href="/assets/js/40.9f1b9e3d.js"><link rel="prefetch" href="/assets/js/41.fc92a0ed.js"><link rel="prefetch" href="/assets/js/42.67b089fe.js"><link rel="prefetch" href="/assets/js/43.994f638e.js"><link rel="prefetch" href="/assets/js/44.23d05733.js"><link rel="prefetch" href="/assets/js/45.d04e70ee.js"><link rel="prefetch" href="/assets/js/46.27d5a367.js"><link rel="prefetch" href="/assets/js/47.c54f29e7.js"><link rel="prefetch" href="/assets/js/5.d89070b9.js"><link rel="prefetch" href="/assets/js/6.1e60fa96.js"><link rel="prefetch" href="/assets/js/7.dd5c479a.js"><link rel="prefetch" href="/assets/js/8.8f5af31a.js"><link rel="prefetch" href="/assets/js/9.77bda456.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e5fe63c7.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">1ms Faster</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Wiki" class="dropdown-title"><a href="/wiki/" class="link-title">Wiki</a> <span class="title" style="display:none;">Wiki</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Program</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/lean_in_c++/" class="nav-link">Lean in C++</a></li></ul></li><li class="dropdown-item"><h4>Perfromance Engineering</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/Performance_Engineering/" class="nav-link">[&gt;&gt;&gt;&gt;&gt;]</a></li></ul></li><li class="dropdown-item"><h4>Reading Note</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/Reading_Notes/" class="nav-link">[&gt;&gt;&gt;&gt;&gt;]</a></li></ul></li><li class="dropdown-item"><h4>ComputeArch</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fb96c7/404" class="nav-link">[_]</a></li></ul></li><li class="dropdown-item"><h4>Compiler</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fb96c7/404" class="nav-link">[_]</a></li></ul></li><li class="dropdown-item"><h4>System</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fb96c7/404" class="nav-link">[_]</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/authoring/" class="nav-link">Authoring</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Archives" class="dropdown-title"><a href="/archives/" class="link-title">Archives</a> <span class="title" style="display:none;">Archives</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">Categories</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">Tags</a></li></ul></div></div> <a href="https://github.com/Quincy-J" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/github_profile_2_1.jpg"> <div class="blogger-info"><h3>Quincy Jet</h3> <span>We are.</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Wiki" class="dropdown-title"><a href="/wiki/" class="link-title">Wiki</a> <span class="title" style="display:none;">Wiki</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Program</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/lean_in_c++/" class="nav-link">Lean in C++</a></li></ul></li><li class="dropdown-item"><h4>Perfromance Engineering</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/Performance_Engineering/" class="nav-link">[&gt;&gt;&gt;&gt;&gt;]</a></li></ul></li><li class="dropdown-item"><h4>Reading Note</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/Reading_Notes/" class="nav-link">[&gt;&gt;&gt;&gt;&gt;]</a></li></ul></li><li class="dropdown-item"><h4>ComputeArch</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fb96c7/404" class="nav-link">[_]</a></li></ul></li><li class="dropdown-item"><h4>Compiler</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fb96c7/404" class="nav-link">[_]</a></li></ul></li><li class="dropdown-item"><h4>System</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fb96c7/404" class="nav-link">[_]</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/authoring/" class="nav-link">Authoring</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Archives" class="dropdown-title"><a href="/archives/" class="link-title">Archives</a> <span class="title" style="display:none;">Archives</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">Categories</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">Tags</a></li></ul></div></div> <a href="https://github.com/Quincy-J" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Lean in c++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Performance Engineering</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Misc</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Reading Notes</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Effective C++</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f9e729/" class="sidebar-link">习惯C++</a></li><li><a href="/pages/0d9870/" class="sidebar-link">构造，析构， 和重载赋值运算符</a></li><li><a href="/pages/ad8b8b/" class="sidebar-link">资源管理</a></li><li><a href="/pages/e85768/" class="sidebar-link">设计与声明</a></li><li><a href="/pages/fb96c7/" aria-current="page" class="active sidebar-link">实现Implementations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/fb96c7/#实现-implementations" class="sidebar-link">实现， Implementations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/fb96c7/#item-26-尽可能延后变量定义式的出现时间-postpone-variable-definitionsas-long-as-possible" class="sidebar-link">Item 26：尽可能延后变量定义式的出现时间 Postpone variable definitionsas long as possible.</a></li><li class="sidebar-sub-header level3"><a href="/pages/fb96c7/#item-27-尽量少做casting-minimize-casting" class="sidebar-link">Item 27：尽量少做Casting， Minimize casting.</a></li><li class="sidebar-sub-header level3"><a href="/pages/fb96c7/#item-28-避免返回handles指向对象内部成分-avoid-returning-handles-toobject-internals" class="sidebar-link">Item 28：避免返回handles指向对象内部成分 Avoid returning&quot;handles&quot;toobject internals.</a></li><li class="sidebar-sub-header level3"><a href="/pages/fb96c7/#item-29-为-异常安全-而努力是值得的-strive-for-exception-safe-code" class="sidebar-link">Item 29：为“异常安全”而努力是值得的 Strive for exception-safe code.</a></li><li class="sidebar-sub-header level3"><a href="/pages/fb96c7/#item-30-透彻了解inlining的里里外外-understand-the-ins-and-outs-of-inlining" class="sidebar-link">Item 30：透彻了解inlining的里里外外     Understand the ins and outs of inlining.</a></li><li class="sidebar-sub-header level3"><a href="/pages/fb96c7/#item-31-将文件间的编译依存关系降至最低-minimize-compilation-dependencies-between-files" class="sidebar-link">Item 31：将文件间的编译依存关系降至最低 Minimize compilation dependencies between files.</a></li></ul></li></ul></li><li><a href="/pages/81fe36/" class="sidebar-link">继承与OOP</a></li><li><a href="/pages/61c62c/" class="sidebar-link">模板，Templates and GP</a></li><li><a href="/pages/875a85/" class="sidebar-link">定制new和delete</a></li><li><a href="/pages/589042/" class="sidebar-link">杂项, Misc</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>More Effective C++</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/wiki/Reading_Notes/" class="sidebar-link">《C++ 性能优化指南》</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/wiki/#Wiki" data-v-06970110>Wiki</a></li><li data-v-06970110><a href="/wiki/#Reading Notes" data-v-06970110>Reading Notes</a></li><li data-v-06970110><a href="/wiki/#Effective C++" data-v-06970110>Effective C++</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://github.com/Quincy-J" target="_blank" title="作者" class="beLink" data-v-06970110>Quincy Jet</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2022-06-27</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">Content</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">实现Implementations<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="实现-implementations"><a href="#实现-implementations" class="header-anchor">#</a> 实现， Implementations</h2> <h3 id="item-26-尽可能延后变量定义式的出现时间-postpone-variable-definitionsas-long-as-possible"><a href="#item-26-尽可能延后变量定义式的出现时间-postpone-variable-definitionsas-long-as-possible" class="header-anchor">#</a> Item 26：尽可能延后变量定义式的出现时间 Postpone variable definitionsas long as possible.</h3> <ol start="26"><li><p>延迟变量定义的出现时间， 尽量<strong>用到的时候再定义；</strong></p> <ol><li>每当定义一个变量时，就会带来构造和析构的运行成本，因为代码运行到定义时会调用对象的构造函数，当离开作用域时便会调用析构函数。</li> <li>把它的定义尽量往后推迟，直到我们100%确定要用到:</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//用:</span>
string <span class="token function">encrypted</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//替换掉:</span>
string encrypted<span class="token punctuation">;</span>
encrypted <span class="token operator">=</span> password<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>我们不仅仅需要把变量的定义推迟到<strong>100%要用到</strong>的地方，还要把它推迟到<strong>100%有构造参数可用</strong>的时候。这样做既可以避免不必要的构造和析构过程，也能节省默认构造再赋值的成本。而且这样的代码也更可读，因为变量定义在了真正需要它的环境下。</p> <p>对于一个变量只在循环里用到，把它定义在循环外面然后每次在里面赋值好，即代码A，还是直接在里面定义呢，即代码B?</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//代码A，在外面定义</span>
Widget w<span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>n<span class="token punctuation">,</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
w<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token comment">//代码B，在里面定义</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
Widget <span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>那么我们就来分析一下A和B各自的运行成本:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>A<span class="token operator">:</span> <span class="token number">1</span>个构造 <span class="token operator">+</span> n个赋值 <span class="token operator">+</span> <span class="token number">1</span>个析构
B<span class="token operator">:</span> n个构造 <span class="token operator">+</span> n个析构
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>对于赋值成本低于(构造+析构)的类，A是更高效的选择，尤其是当n很大的时候。反之如果赋值成本大于(构造+析构)，B则是更好的选择。但是对象在A的作用域比在B要大，有时是不利于程序的可读性和可维护性的。因此<strong>除非</strong>你知道赋值成本低于(构造+析构)，而且这段代码要更注重效率，那么我们应该默认使用B。</p></li></ol> <h3 id="item-27-尽量少做casting-minimize-casting"><a href="#item-27-尽量少做casting-minimize-casting" class="header-anchor">#</a> Item 27：尽量少做Casting， Minimize casting.</h3> <ol start="27"><li><p>少做cast转型动作， 即使要用也尽量使用C++自己的那四个转型, 这里涉及几种C++形式的转换的作用和相关的优缺点</p> <ol><li>C++的类型转换有3种方式，C风格，函数风格和C++风格:</li></ol></li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token punctuation">(</span>T<span class="token punctuation">)</span>expression  <span class="token comment">//C风格</span>
<span class="token function">T</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span> <span class="token comment">//函数风格</span>

<span class="token comment">//C++风格</span>
<span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span>
<span class="token generic-function"><span class="token function">dynamic_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span>     <span class="token comment">//T必须是指向多态类型的指针或引用</span>
<span class="token generic-function"><span class="token function">const_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span>       <span class="token comment">//T必须是指针或引用</span>
<span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span> <span class="token comment">//T必须是指针或引用</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如果一定要转型， 请放在函数里面， 不要让用户在使用这个函数的时候还要惦记转型的事情；</p> <h3 id="item-28-避免返回handles指向对象内部成分-avoid-returning-handles-toobject-internals"><a href="#item-28-避免返回handles指向对象内部成分-avoid-returning-handles-toobject-internals" class="header-anchor">#</a> Item 28：避免返回handles指向对象内部成分 Avoid returning&quot;handles&quot;toobject internals.</h3> <ol start="28"><li><p>避免返回一个handler， 这个handler却有指向对象的内部成分，</p> <ol><li><p>如果一个函数返回了指向<strong>储存在对象外部</strong>的数据成员的引用，即使这个函数声明为了const，调用这个函数的人也能修改这个成员(见<a href="https://zhuanlan.zhihu.com/p/63609476" target="_blank" rel="noopener noreferrer">第3章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>bitwise constness的局限性)</p></li> <li><p>避免返回的是一个空悬的指针；</p></li> <li><p>避免可以使用调用的操作来对函数内部的元素进行修改， 可以指定返回值是一个const， 这样用户就不能修改了；</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">Rectangle</span><span class="token punctuation">{</span>
  <span class="token keyword">public</span><span class="token operator">:</span>   
    <span class="token comment">//现在返回的是const Point&amp;   </span>
    <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> <span class="token function">upperLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span><span class="token keyword">return</span> pData<span class="token operator">-&gt;</span>ulhc<span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> <span class="token function">lowerRight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span><span class="token keyword">return</span> pData<span class="token operator">-&gt;</span>lrhc<span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>避免返回指向内部成员的&quot;句柄&quot;，包括指针，引用，迭代器。不返回&quot;句柄&quot;能增强封装性，让const函数真正const，也能减少&quot;野句柄&quot;。</p></li></ol></li></ol> <h3 id="item-29-为-异常安全-而努力是值得的-strive-for-exception-safe-code"><a href="#item-29-为-异常安全-而努力是值得的-strive-for-exception-safe-code" class="header-anchor">#</a> Item 29：为“异常安全”而努力是值得的 Strive for exception-safe code.</h3> <ol start="29"><li><p>注意异常安全， （exceptional C++里面有很多异常安全的相关介绍）</p> <ul><li><p>异常安全</p> <blockquote><p><em><strong>异常安全***的意思就是，<em><strong>当程序在异常发生的时候，程序可以回退的很干净</strong></em>。什么是回退的很干净呢？其实就是函数在发生异常的时候***不会泄露资源***或者***不会发生任何数据结构的破坏</strong></em>。</p></blockquote> <p>不泄露任何资源</p> <p>不允许破坏任何数据</p></li></ul></li></ol> <ul><li><p>异常安全的函数即使在抛出异常时也不会泄露资源，损坏数据结构。这种安全性有三种级别，基本保证，强保证和不抛出保证</p> <ul><li>提供<strong>基本保证</strong>(basic guarantee)的函数可以保证即使抛出了异常，函数也能在有效的状态下运行，没有对象或数据损坏，所有对象也保持内部一致，依然满足类不变量(class invariant)，但是程序本身则可能处于不确定状态。例如用户使用我们changeBackground方法时抛出了异常，PrettyMenu对象可能依然持有原来的背景，或者持有默认的背景，但具体哪个则是不确定的。</li> <li>提供<strong>强保证</strong>(strong guarantee)的函数可以保证如果函数抛出了异常，程序的状态不会改变。这就意味着对强保证函数的调用是原子性的(atomic)，如果成功了就成功了，如果失败了就像什么都没有发生一样。强保证函数比基本保证函数更容易使用，因为强保证函数只能导致两种状态，成功或者不变，而基本保证的函数可能引向任何状态。</li> <li>提供<strong>不抛出保证</strong>(nothrow guarantee)的函数保证永远不会抛出异常。例如所有对于基本类型(int，指针等等)的操作都提供不抛出保证。它是异常安全代码的基础。</li></ul></li> <li><p>copy and swap是实现强保证的有效方法，但给所有的函数加上强保证显然也不是实际的选择</p></li> <li><p>函数的异常安全性遵循木桶原理，函数的最强安全性取决于它所调用操作的最弱安全性</p></li></ul> <h3 id="item-30-透彻了解inlining的里里外外-understand-the-ins-and-outs-of-inlining"><a href="#item-30-透彻了解inlining的里里外外-understand-the-ins-and-outs-of-inlining" class="header-anchor">#</a> Item 30：透彻了解inlining的里里外外     Understand the ins and outs of inlining.</h3> <ol start="30"><li>对inline的里里外外需要透彻了解；</li></ol> <ul><li>尽量inline， 也许compiler就能够执行context相关的inline优化；</li> <li>定义在类里面的函数， 自动inline</li> <li>inline会让代码文件变大， 会导致更多的换页行为（paging），降低 i cache的命中率, 如果函数比较小， inline对 icache miss的影响会稍微比较小， 但是inline的函数比较大， 就有可能会得不偿失；</li> <li>虚函数的inline， 大多都不会生效</li> <li>inline不仅会导致代码变大， 而且一旦inline的函数发生改变， 所有用到inline function的地方都要重新编译</li> <li>inline函数一般放在头文件里面， template一般也都是发那个在头文件里面；</li> <li>template要避免无脑成为一个inline函数， 它的代价是很大的；因为可能程序中很多地方都用到了这个模板</li></ul> <h3 id="item-31-将文件间的编译依存关系降至最低-minimize-compilation-dependencies-between-files"><a href="#item-31-将文件间的编译依存关系降至最低-minimize-compilation-dependencies-between-files" class="header-anchor">#</a> Item 31：将文件间的编译依存关系降至最低 Minimize compilation dependencies between files.</h3> <ol start="31"><li>尽量减少文件之间的编译依赖关系；不然修改之后编译， 会导致很多部件都一起编译了【缺demo】</li></ol> <ul><li>头文件应该仅有声明不要有定义；</li> <li>可以只有声明， 而没有定义， 这会导致一个方法： 前向声明， 前向声明只是把#include的内容， 放在代码的前面；</li> <li>一般使用pointer to implementation 和纯虚函数的工厂方法来解决， 前者叫handle class, 后者叫interface class;</li></ul></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/e85768/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">设计与声明</div></a> <a href="/pages/81fe36/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">继承与OOP</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/e85768/" class="prev">设计与声明</a></span> <span class="next"><a href="/pages/81fe36/">继承与OOP</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:quincy_jet@outlook.com" title="E-Mail" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Quincy-J" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
    Copyright © 2017-2023
    <span>Quincy Jet | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          Auto 
        </li><li class="iconfont icon-rijianmoshi">
          Light 
        </li><li class="iconfont icon-yejianmoshi">
          Dark 
        </li><li class="iconfont icon-yuedu">
          Read
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3f18542a.js" defer></script><script src="/assets/js/2.0eed2333.js" defer></script><script src="/assets/js/3.1c18827c.js" defer></script><script src="/assets/js/29.93771d6e.js" defer></script>
  </body>
</html>
