<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《More Effective C++》 | 1ms Faster</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/more.png">
    <meta name="description" content="Software performace profile/analysis/optimization">
    <meta name="keywords" content="optimization, analysis, profile, performance, latency, throughput, metrics, linux, cache, CPU, architecture">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.e5fe63c7.css" as="style"><link rel="preload" href="/assets/js/app.0156df4b.js" as="script"><link rel="preload" href="/assets/js/2.0eed2333.js" as="script"><link rel="preload" href="/assets/js/3.1c18827c.js" as="script"><link rel="preload" href="/assets/js/28.17e2f19b.js" as="script"><link rel="prefetch" href="/assets/js/10.20339081.js"><link rel="prefetch" href="/assets/js/11.9e667a20.js"><link rel="prefetch" href="/assets/js/12.e10ed919.js"><link rel="prefetch" href="/assets/js/13.5b153336.js"><link rel="prefetch" href="/assets/js/14.c9818bab.js"><link rel="prefetch" href="/assets/js/15.e1d4e55a.js"><link rel="prefetch" href="/assets/js/16.b5733294.js"><link rel="prefetch" href="/assets/js/17.6ebbc744.js"><link rel="prefetch" href="/assets/js/18.70850c97.js"><link rel="prefetch" href="/assets/js/19.58d5cecb.js"><link rel="prefetch" href="/assets/js/20.8bcfd87e.js"><link rel="prefetch" href="/assets/js/21.b607bcc6.js"><link rel="prefetch" href="/assets/js/22.bbfb5196.js"><link rel="prefetch" href="/assets/js/23.ca136498.js"><link rel="prefetch" href="/assets/js/24.c1071b43.js"><link rel="prefetch" href="/assets/js/25.6ce26b28.js"><link rel="prefetch" href="/assets/js/26.458ab7f2.js"><link rel="prefetch" href="/assets/js/27.f7c3a9aa.js"><link rel="prefetch" href="/assets/js/29.0a5e6199.js"><link rel="prefetch" href="/assets/js/30.c0596552.js"><link rel="prefetch" href="/assets/js/31.df994b91.js"><link rel="prefetch" href="/assets/js/32.630e34e4.js"><link rel="prefetch" href="/assets/js/33.e7b9c15b.js"><link rel="prefetch" href="/assets/js/34.28850efd.js"><link rel="prefetch" href="/assets/js/35.d59ef49e.js"><link rel="prefetch" href="/assets/js/36.85959914.js"><link rel="prefetch" href="/assets/js/4.0f2ca733.js"><link rel="prefetch" href="/assets/js/5.d89070b9.js"><link rel="prefetch" href="/assets/js/6.1e60fa96.js"><link rel="prefetch" href="/assets/js/7.77c61ade.js"><link rel="prefetch" href="/assets/js/8.9251176b.js"><link rel="prefetch" href="/assets/js/9.77bda456.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e5fe63c7.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">1ms Faster</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Wiki" class="dropdown-title"><a href="/wiki/" class="link-title">Wiki</a> <span class="title" style="display:none;">Wiki</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Program</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/lean_in_c++/" class="nav-link">Lean in C++</a></li></ul></li><li class="dropdown-item"><h4>Perfromance Engineering</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/Performance_Engineering/" class="nav-link">[&gt;&gt;&gt;&gt;&gt;]</a></li></ul></li><li class="dropdown-item"><h4>Reading Note</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/Reading_Notes/" class="nav-link">[&gt;&gt;&gt;&gt;&gt;]</a></li></ul></li><li class="dropdown-item"><h4>ComputeArch</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8cb6bc/404" class="nav-link">[_]</a></li></ul></li><li class="dropdown-item"><h4>Compiler</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8cb6bc/404" class="nav-link">[_]</a></li></ul></li><li class="dropdown-item"><h4>System</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8cb6bc/404" class="nav-link">[_]</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/authoring/" class="nav-link">Authoring</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Archives" class="dropdown-title"><a href="/archives/" class="link-title">Archives</a> <span class="title" style="display:none;">Archives</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">Categories</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">Tags</a></li></ul></div></div> <a href="https://github.com/Quincy-J" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/github_profile_2_1.jpg"> <div class="blogger-info"><h3>Quincy Jet</h3> <span>We are.</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Wiki" class="dropdown-title"><a href="/wiki/" class="link-title">Wiki</a> <span class="title" style="display:none;">Wiki</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Program</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/lean_in_c++/" class="nav-link">Lean in C++</a></li></ul></li><li class="dropdown-item"><h4>Perfromance Engineering</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/Performance_Engineering/" class="nav-link">[&gt;&gt;&gt;&gt;&gt;]</a></li></ul></li><li class="dropdown-item"><h4>Reading Note</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/Reading_Notes/" class="nav-link">[&gt;&gt;&gt;&gt;&gt;]</a></li></ul></li><li class="dropdown-item"><h4>ComputeArch</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8cb6bc/404" class="nav-link">[_]</a></li></ul></li><li class="dropdown-item"><h4>Compiler</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8cb6bc/404" class="nav-link">[_]</a></li></ul></li><li class="dropdown-item"><h4>System</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8cb6bc/404" class="nav-link">[_]</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/authoring/" class="nav-link">Authoring</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Archives" class="dropdown-title"><a href="/archives/" class="link-title">Archives</a> <span class="title" style="display:none;">Archives</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">Categories</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">Tags</a></li></ul></div></div> <a href="https://github.com/Quincy-J" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Lean in c++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Performance Engineering</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Misc</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Reading Notes</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Effective C++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>More Effective C++</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/8cb6bc/" aria-current="page" class="active sidebar-link">《More Effective C++》</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/8cb6bc/#基础议题" class="sidebar-link">基础议题</a></li><li class="sidebar-sub-header level2"><a href="/pages/8cb6bc/#操作符-operators" class="sidebar-link">操作符（operators）</a></li><li class="sidebar-sub-header level2"><a href="/pages/8cb6bc/#异常-exceptions" class="sidebar-link">异常（exceptions）</a></li><li class="sidebar-sub-header level2"><a href="/pages/8cb6bc/#效率-efficiency-这部分可以参考高性能c-相关的书籍" class="sidebar-link">效率（efficiency）, 这部分可以参考高性能C++相关的书籍</a></li><li class="sidebar-sub-header level2"><a href="/pages/8cb6bc/#技术-techniques-idioms-patterns" class="sidebar-link">技术（techniques, idioms, patterns）</a></li><li class="sidebar-sub-header level2"><a href="/pages/8cb6bc/#杂项讨论-misc" class="sidebar-link">杂项讨论，Misc</a></li></ul></li></ul></section></li><li><a href="/wiki/Reading_Notes/" class="sidebar-link">《C++ 性能优化指南》</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/wiki/#Wiki" data-v-06970110>Wiki</a></li><li data-v-06970110><a href="/wiki/#Reading Notes" data-v-06970110>Reading Notes</a></li><li data-v-06970110><a href="/wiki/#More Effective C++" data-v-06970110>More Effective C++</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://github.com/Quincy-J" target="_blank" title="作者" class="beLink" data-v-06970110>Quincy Jet</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2022-06-27</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">Content</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">《More Effective C++》<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="more-effective-c"><a href="#more-effective-c" class="header-anchor">#</a> More Effective C++</h1> <h2 id="基础议题"><a href="#基础议题" class="header-anchor">#</a> 基础议题</h2> <ol><li><p>仔细区分pointer和reference</p> <ul><li>reference 一定得代表某个对象，C++因此要求 references 必须有初值</li> <li>用 references 可能会比使用pointers 更富效率。这是因为使用 reference 之前不需要测试其有效性, 如果是指针, 需要判断if(pc), 是否是nullptr</li> <li>Pointers 和 references 之间的另一个重要差异就是，pointers 可以被重新赋值</li></ul></li> <li><p>最好是使用C++的cast操作(static_cast(), const_cast(), reinterprete_cast(), dynamic_cast())；</p> <ul><li>static_cast 基本上拥有与 C 旧式转型相同的威力与意义，以及相同的限制。</li> <li>const_cast 用来改变表达式中的常量性（constness）或变易性（volatileness）</li> <li>dynamic_cast，用来执行继承体系中“安全的向下转型或跨系转型动作”。也就是说你可以利用 dynamic_cast，将“指向 base class objects的 pointers或 references”转型为“指向 derived（或 sibling base）class objects的 pointers 或 references”，并得知转型是否成功1。</li> <li>reinterpret_cast转换结果几乎总是与编译平台息息相关。所以 reinterpret_casts 不具移植性。reinterpret_cast 的最常用用途是转换“函数指针”类型。</li></ul></li> <li><p>不要以多态的方式处理数组， 因为多态的时候, 导致数组里面元素的大小不一样， 在数组里面slicing会导致便偏移错误；</p> <p>Example:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// sample code</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>非必要不使用默认的default constructor，
在一个完美的世界中，凡可以“合理地从无到有生成对象”的 classes，都应该内含 default constructors，而“必须有某些外来信息才能生成对象”的 classes，则不必拥有 default constructors。但我们的世界毕竟不是完美的世界，所以我们必须纳入其他考虑。</p> <p>如果 class 缺乏一个 default constructor，当你使用这个class 时便会有某些限制。</p> <p>无意义 default constructors，会影响 classes 效率。member functions 必须检测这个字段是否被初始化， 要花更多的时间和空间（这个类也变大了）；</p> <p>到底要不要有 default constructor，最后还是要看 virtual base classes （见条款 E43）有关。虚基类必须要有默认的构造函数。因为 virtual base class constructors 的自变量必须由欲产生的对象的派生层次最深（所谓 most derived）的 class 提供。一个缺乏 default constructor的 virtual base class，要求其所有的 derived classes都必须知道、了解其意义，这太难了</p></li></ol> <h2 id="操作符-operators"><a href="#操作符-operators" class="header-anchor">#</a> 操作符（operators）</h2> <ol start="5"><li><p>自己定制的类型转换函数， 需要保持警惕, 也就是拷贝构造, 拷贝赋值; 允许编译器执行隐式类型转换, 坏处大于好处;</p> <ul><li>并且主要是一些内建default对类对象的类型转换</li> <li>因为有一些转换函数， 在一些自己想不到的时候， 会被偶然间调用；</li> <li>自定义的类型转换,要避免发生隐式类型转换, 它最好只能够非常清晰地从type A到typeB</li> <li>关键词 explicit。这个特性之所以被导入，就是为了解决隐式类型转换带来的问题。其用法十分直接易懂，只要将 constructors声明为 explicit，编译器便不能因隐式类型转换的需要而调用它们。单一参数的构造函数， 加上explicit</li> <li>类似 ArraySize 这样的 classes，往往被称为proxy classes，因为它的每一个对象都是为了其他对象而存在的， <img src="/2_More_Effective_C++.assets/epub_33381011_65.jpeg" alt="img" style="zoom:50%;"></li></ul></li> <li><p>区别C++， 和++C这两个操作符重载时候的区别, ++C没有临时变量, C++是有的</p> <ul><li><p>重载的时候, 前置是operator++(), 后置是operator++(int)， 所以后置的时候， 会用到前置的重构在函数</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">const</span> UPInt UPInt<span class="token double-colon punctuation">::</span>opreator<span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span> <span class="token comment">// ++a</span>

<span class="token keyword">const</span> UPInt UPInt<span class="token double-colon punctuation">::</span>opreator<span class="token operator">++</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	UPInt oldValue <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token operator">++</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>	
<span class="token punctuation">}</span> <span class="token comment">// a++</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ul></li> <li><p>不要重载&amp;&amp;，||和，操作符；因为重载这些操作符的参数, 再调用这些重载函数的时候, 都需要已经被计算出来, 但是通常我们在使用这些操作符的时候会把一些没有计算出来的表达式放在里面去做||, &amp;&amp;操作;
C++并未明确定义函数调用动作中各参数的计算顺序，所以没办法知道 那个变量中的哪个会先被计算出来。</p></li> <li><p><u>对不同含义的new和delete， 需要充分搞清楚区别和含义；[拓展： 侯捷, 内存管理课程]</u></p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// 指针数组</span>
<span class="token keyword">int</span><span class="token operator">*</span> bestPractice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token operator">*</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 数组指针</span>


<span class="token comment">// new operator:</span>
string <span class="token operator">*</span>ps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">string</span><span class="token punctuation">(</span><span class="token string">&quot;Memory management&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span> ps<span class="token punctuation">;</span> <span class="token comment">//只有new operator出来的内存才能delete， malloc出来的要经过cast成为对象的指针才能够使用delete；</span>
<span class="token keyword">delete</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> ps<span class="token punctuation">;</span> <span class="token comment">// 如果ps是一个数组的话；</span>

<span class="token comment">// operator new:</span>
<span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>size_t<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//可以直接这样使用，像使用malloc一样， 把内存转换成对象是new operator做的事情；</span>
<span class="token keyword">void</span><span class="token operator">*</span> rawMemory <span class="token operator">=</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
operater <span class="token keyword">delete</span><span class="token punctuation">(</span>rawMemory<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// operator delete</span>

<span class="token comment">//placement new</span>
Widget<span class="token operator">*</span> <span class="token function">constructWidgetInBuffer</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> widgetSize<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span> <span class="token function">Widget</span><span class="token punctuation">(</span>widgetSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li></ol> <h2 id="异常-exceptions"><a href="#异常-exceptions" class="header-anchor">#</a> 异常（exceptions）</h2> <ol start="9"><li><p>利用destructor来避免资源的泄露（什么是资源泄露？没有delete的指针）， 最好还是使用智能指针的类来处理会比较好；</p> <p>要么catch到exception之后， 要及时释放资源， 避免资源泄露；</p> <p>要么就在destructor里面， 增加资源的释放， 即使遇到异常， 退出的时候也会调用析构函数里面的delete；</p> <p>使用智能指针， auto_ptr(), shared_ptr(), weak_ptr()</p></li> <li><p>利用constructor来避免资源泄露（最好还是使用智能指针的类比较好）</p> <ul><li>在构造新对象的过程中， 如果构造失败， 就可能会造成资源泄露</li> <li>所以要直接在构造函数里面对构造失败的异常进行捕获， 并且处理好这些异常， 对野指针进行delete。</li> <li>把这些指针的删除， 囊括在一个clean up()的函数里面；</li> <li>指向const的指针， 只能在初始化列表里面进行初始化， 这些对象的初始化过程中的异常， 可以放在一个private函数里面去进行，</li> <li>不过最好还是使用auto_ptr之类的东西， 直接去管理类的成员数据， 比较方便一些</li> <li>由于 C++不自动清理那些“构造期间抛出 exceptions”的对象，所以你必须设计你的 constructors，使它们在那种情况下亦能自我清理。</li></ul></li> <li><p>别让异常流出destructor;</p> <ol><li><p>第一，它可以避免 terminate函数在exception传播过程的栈展开（stack-unwinding）机制中被调用；</p></li> <li><p>第二，它可以协助确保 destructors 完成其应该完成的所有事情。</p></li></ol></li> <li><p>弄清楚， 抛出一个异常， 和 传递一个参数之间的区别<img src="/2_More_Effective_C++.assets/epub_33381011_142.jpeg" alt="img"></p></li> <li><p>以 by reference的方式捕获一个exception; 既没有by value的复制问题 也没有by pointer 的局部对象问题；</p> <p>by pointer 可能会遇到下面的问题：当ex不是一个global或者是static对象， 而是一个局部对象的时候， 就会出错<img src="/2_More_Effective_C++.assets/epub_33381011_148.jpeg" alt="img"></p></li> <li><p>明智地运用exception specification<img src="/2_More_Effective_C++.assets/epub_33381011_156.jpeg" alt="img"></p></li> <li><p>清楚异常处理带来的成本；
粗略估计，如果使用 try 语句块，代码大约整体膨胀 5%～10%，执行速度亦大约下降这个数。这是在假设没有任何 exceptions 被抛出的情况下。此处我们所讨论的只是“代码中出现 try 语句块”的成本而已。</p> <p>主要是时间和空间上面的成本；</p></li></ol> <p>需要讨论， C++ runtime时候， 编译， 连接的时候，对这些exceptions是怎么处理的？</p> <h2 id="效率-efficiency-这部分可以参考高性能c-相关的书籍"><a href="#效率-efficiency-这部分可以参考高性能c-相关的书籍" class="header-anchor">#</a> 效率（efficiency）, 这部分可以参考高性能C++相关的书籍</h2> <p>与运行时， 虚函数， 以及对象的内存模型相关的知识；</p> <ol start="16"><li>要清楚80-20法则， 有时候还是根方效率， 也就是100个人里面， 只有10个人完成了一半的工作， 10000个人里面只有100个人完成了一半的工作；</li></ol> <ul><li>只有20%代码占用了程序的80%的时间</li></ul> <ol start="17"><li>考虑使用缓式评估（lazy evaluation）</li></ol> <ul><li>用到的时候, 再把需要的中间变量计算出来, 不然过早计算, 可能后面会用不到,</li> <li>避免不必要的重复冗余计算;</li> <li>用到的变量, 也是这样, 过早声明定义, 有可能会浪费</li></ul> <ol start="18"><li><p>分期摊还预期的计算成本</p></li> <li><p>软件层面上做Cache和prefetch</p></li> <li><p>了解临时对象是从哪里来的；</p></li> <li><p>协助程序完成返回值优化（RVO）
在return by value的时候， 在最后return的语句里面，直接返回实例的表达式， 可以省去在函数体内部多出来的一个临时对象；</p></li> <li><p>利用overloading来避免隐式类型转换</p></li> <li><p>考虑使用操作符复合形式（op=）取代其独立的形式（op）</p> <p>+= 比 + 拥有更少的临时对象，
在进行操作符重载的时候， 独立形式的操作符也会使用复合形式的操作符重载来完成， 和++a a++一样， 都会有多余的overhead；</p></li> <li><p>积极使用其他的库</p> <p>比如OneDNN / MKL、 libevent， 以及一些网络的库</p></li> <li><p>虚函数， 多重继承，虚基类， RTTI的成本代价是什么</p> <p>主要是对象的内存模型相关的内容， 对象模型那本书里面有更详细的讲解；</p></li></ol> <h2 id="技术-techniques-idioms-patterns"><a href="#技术-techniques-idioms-patterns" class="header-anchor">#</a> 技术（techniques, idioms, patterns）</h2> <p>这部分内容更像是设计模式要解决的相关的问题；</p> <ol start="25"><li><p>将copy constructor和non member functions 虚化</p> <p>virtual copy constructor 感觉和设计模式里面的工厂模式是差不多的概念</p> <p>non-member function的虚化：写一个虚函数做实际工作，再写一个什么都不做的非虚函数，只负责调用虚函数。当然啦，为了避免此巧妙安排蒙受函数调用所带来的成本，你可以将非虚函数 inline 化（</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">A</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">virtual</span> std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span><span class="token function">print</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span>s<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">B</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">A</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">virtual</span> std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span><span class="token function">print</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span>s<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> s <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;i am b&quot;</span><span class="token punctuation">;</span> <span class="token keyword">return</span> s<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">A</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">virtual</span> std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span><span class="token function">print</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span>s<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> s <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;i am c&quot;</span><span class="token punctuation">;</span> <span class="token keyword">return</span> s<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span><span class="token keyword">operator</span> <span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span>s<span class="token punctuation">,</span> <span class="token keyword">const</span> A <span class="token operator">&amp;</span>a<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    B b<span class="token punctuation">;</span>
    C c<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> b <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span> <span class="token operator">&lt;&lt;</span> c <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div></li> <li><p><strong>限制某个class所能产生的对象数量(如果只是一个， 那么用static对象， 记得看singleton设计模式)</strong></p> <p>引用计数</p> <p>使用全局函数， 并且用private来封锁ctor和dtor，全局函数里面包裹一个static的对象， 只能产生一个：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">Printer</span><span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">submitJob</span><span class="token punctuation">(</span><span class="token keyword">const</span> PrintJob<span class="token operator">&amp;</span> Job<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   	<span class="token keyword">void</span> <span class="token function">performSelfTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">friend</span> Printer<span class="token operator">&amp;</span> <span class="token function">thePrinter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token function">Printer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Printer</span><span class="token punctuation">(</span><span class="token keyword">const</span> Printer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

Printer<span class="token operator">&amp;</span> <span class="token function">thePrinter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">static</span> Printer p<span class="token punctuation">;</span>
    <span class="token keyword">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>但是全局函数是不安全的， 最好不要动不动就用全局的东西</p> <p>使用namespace来包裹一下这个全局函数；</p> <p>`“class拥有一个 static对象”的意思是：即使从未被用到，它也会被构造（及析构）。相反地“函数拥有一个 static 对象”的意思是：此对象在函数第一次被调用时才产生。如果该函数从未被调用，这个对象也就绝不会诞生（然而你必须付出代价，在函数每次被调用时检查对象是否需要诞生）</p></li> <li><p>人工限制或者禁止对象产生与heap之中</p> <p>限制只能在heap里面产生对象， 就要把常规的构造和析构函数， 设置成为private：（private不能继承， 但是可以弄成protected的，但是protected就不知道是在heap上还是stack上面了）</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">A</span>
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">/* 做一个伪析构 */</span>
    <span class="token keyword">void</span> <span class="token function">destory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token operator">~</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">/* 析构函数设为私有，防止在栈上构建对象 */</span>
    <span class="token operator">~</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">M</span>
<span class="token punctuation">{</span>
    <span class="token comment">// A a_; /* 错误，不可在堆上创建 */</span>
    A <span class="token operator">*</span>pa_<span class="token punctuation">;</span> <span class="token comment">/* 在内含类中，需要改为指针使用 */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// A a; /* 错误 */</span>
    A <span class="token operator">*</span>pa <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 正确 */</span>
    <span class="token comment">// delete pa; /* 错误 */</span>
    pa<span class="token operator">-&gt;</span><span class="token function">destory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 正确 */</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>禁止在heap上产生对象， 要把operator new()， operator new<a href=""></a>以及相应的delete函数放在private里面；</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">A</span>
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">/* 用c++11的方式 */</span>
    <span class="token comment">/*
        static void *operator new(size_t) = delete;
        static void operator delete(void *) = delete;
        static void *operator new [](size_t) = delete;
        static void operator delete [](void *) =delete;
    */</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>size_t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token keyword">operator</span> <span class="token keyword">new</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>size_t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    A a<span class="token punctuation">;</span>
    <span class="token comment">// A *pa = new A();   /* 错误 */</span>
    <span class="token comment">// A *pa = new A[10]; /* 错误 */</span>
    A <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span>
    <span class="token comment">// delete p; /* 错误，delete已经被私有化，编译器就可以报错，delete []同原理 */</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></li> <li><p>smart pointer智能指针</p> <p>现代C++里面， 主要是auto_ptr(), shared_ptr()相关的类型， 可以使用；</p></li> <li><p>reference counter引用技术 、 copy on write相关的技术</p></li> <li><p>proxy class</p> <p>代理类实际上有三种好处，</p> <ul><li>实现多维数组： 真实数组为一个一维数组，内嵌代理为一个一维数组，组合起来就是一个二维数组</li> <li>区分读写</li> <li>压制隐式转换
因为返回的类型为代理类类型，所以很多操作需要隐式类型转换，如果代理类没实现，就不能进行隐式类型转换，这样可以有效的压制隐式类型转换</li></ul></li> <li><p>让函数根据一个以上的对象类型来决定如何虚化这个函数；</p> <p>虚函数的调用其实也可以理解为一个message dispatch,  如果一个虚函数要根据两个参数的类型来进行虚化， 则称为 double dispatch,</p> <p>使用RTTI， typeid();</p></li></ol> <h2 id="杂项讨论-misc"><a href="#杂项讨论-misc" class="header-anchor">#</a> 杂项讨论，Misc</h2> <ol start="32"><li><p>在未来时态下发展程序， 为以后程序的变动留下足够的弹性设计空间；（设计模式和设计经验， 架构的经验）</p> <p>● 提供完整的 classes（见条款 E18）——即使某些部分目前用不到。当新的需求进来，你不太需要回头去修改那些 classes。</p> <p>● 设计你的接口，使有利于共同的操作行为，阻止共同的错误（见条款 E46）。让这些 classes 轻易地被正确运用，难以被错误运用。例如，面对那些“copying和 assignment 并不合理”的classes，请禁止那些动作的发生（见条款 E27）。请防止部分赋值（partial assignments，见条款 33）的发生。</p> <p>● 尽量使你的代码一般化（泛化），除非有不良的巨大后果。举个例子，如果你正在写一个算法，用于树状结构（tree）的来回遍历，请考虑将它一般化，以便能够处理任何种类的 directed acyclic（非环状的）graph</p></li> <li><p>将non leaf class 设计为一个抽象类</p></li> <li><p>如何在同一个程序中结合C和C++</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_cplusplus</span></span>
<span class="token keyword">extern</span> <span class="token string">&quot;C&quot;</span> <span class="token punctuation">{</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_cplusplus</span></span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>static class 对象、全局对象、namespace 内的对象以及文件范围（file scope）内的对象，其 constructors 总是在 main 之前就获得执行。这个过程称为 static initialization（见条款 E47</p></li> <li><p>让自己习惯于标准的C++的一些新特性，</p> <ul><li>支持数值应用。复数（complex numbers）长久以来是许多 C++教科书的示范对象，如今终于被奉祀于标准程序库的殿堂上。此外，标准程序库还包含特殊的数组类（valarrays），可以制止别名（aliasing）的发生。这些数组比传统的内建数组有更进取的优化倾向，特别是在多进程结构体系（multiprocessing architectures）下。标准程序库也提供一些常用的数值函数，包括“部分和（partial sum）”以及“相邻差值（adjacent difference）”。●</li> <li>支持广泛用途的 containers（容器）和 algorithms（算法）。C++标准程序库内含一组 class templates 和 function templates，统称为 Standard Template Library（STL）。STL 是 C++标准程序库中最具革命性的部分。稍后我会摘要说明其特征。</li> <li>支持数值应用。复数（complex numbers）长久以来是许多 C++教科书的示范对象，如今终于被奉祀于标准程序库的殿堂上。此外，标准程序库还包含特殊的数组类（valarrays），可以制止别名（aliasing）的发生。这些数组比传统的内建数组有更进取的优化倾向，特别是在多进程结构体系（multiprocessing architectures）下。标准程序库也提供一些常用的数值函数，包括“部分和（partial sum）”以及“相邻差值（adjacent difference）”。</li> <li>支持广泛用途的 containers（容器）和 algorithms（算法）。C++标准程序库内含一组 class templates 和 function templates，统称为 Standard Template Library（STL）。STL 是 C++标准程序库中最具革命性的部分。稍后我会摘要说明其特征。</li> <li>STL
<ul><li>支持 C标准函数库。别担心，C++还记得它的根源。某些微小的变化，使“C++版本的 C函数库”与“C++的强烈类型检验性质”得以一致。但是，你对 C函数库所知道的一切，以及对它的爱恨情仇，在 C++中都依然存在。</li> <li>支持 strings。就像 C++标准程序库小组主席 Mike Vilot所说：“如果没有提供一个标准的 string 类型，恐怕会出现街头流血事件！”（有些人就是这么感情用事。）冷静点，放下那些砖头棍棒——C++标准程序库提供了 string。</li> <li>支持国别（地域别、本土化，localization）。不同的文化使用不同的字符集，并在显示日期、时间、排序事物、货币值的时候有着不同的习俗。标准程序库对于国别的支持，使程序开发得以轻松容纳多种文化差异。</li> <li>支持 I/O。iostream 程序库仍旧是标准 C++的一部分，但是委员会对它做了一些修补。虽然某些 classes 被剔除了（特别值得注意的是 iostream 和fstream），某些 classes 被取代了（例如 string-based stringstreams 取代了 char＊-based strstreams，后者不再被标准委员会认可），不过 iostream 内的各个标准 classes仍可忠实反映那些早已存在多年的基本功能。</li> <li>支持数值应用。复数（complex numbers）长久以来是许多 C++教科书的示范对象，如今终于被奉祀于标准程序库的殿堂上。此外，标准程序库还包含特殊的数组类（valarrays），可以制止别名（aliasing）的发生。这些数组比传统的内建数组有更进取的优化倾向，特别是在多进程结构体系（multiprocessing architectures）下。标准程序库也提供一些常用的数值函数，包括“部分和（partial sum）”以及“相邻差值（adjacent difference）”。</li> <li>支持数值应用。复数（complex numbers）长久以来是许多 C++教科书的示范对象，如今终于被奉祀于标准程序库的殿堂上。此外，标准程序库还包含特殊的数组类（valarrays），可以制止别名（aliasing）的发生。这些数组比传统的内建数组有更进取的优化倾向，特别是在多进程结构体系（multiprocessing architectures）下。标准程序库也提供一些常用的数值函数，包括“部分和（partial sum）”以及“相邻差值（adjacent difference）”。</li> <li>支持广泛用途的 containers（容器）和 algorithms（算法）。C++标准程序库内含一组 class templates 和 function templates，统称为 Standard Template Library（STL）。STL 是 C++标准程序库中最具革命性的部分。稍后我会摘要说明其特征。</li></ul></li></ul></li></ol> <p>推荐的阅读清单： 后面可以一起总结</p> <p>一个造轮子的repo： https://github.com/codecrafters-io/build-your-own-x</p> <p>shared_ptr()代码</p> <p>auto_ptr()</p></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/acf349/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">习惯C++</div></a> <a href="/wiki/Reading_Notes/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">《C++ 性能优化指南》</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/acf349/" class="prev">习惯C++</a></span> <span class="next"><a href="/wiki/Reading_Notes/">《C++ 性能优化指南》</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:quincy_jet@outlook.com" title="E-Mail" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Quincy-J" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
    Copyright © 2017-2023
    <span>Quincy Jet | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          Auto 
        </li><li class="iconfont icon-rijianmoshi">
          Light 
        </li><li class="iconfont icon-yejianmoshi">
          Dark 
        </li><li class="iconfont icon-yuedu">
          Read
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0156df4b.js" defer></script><script src="/assets/js/2.0eed2333.js" defer></script><script src="/assets/js/3.1c18827c.js" defer></script><script src="/assets/js/28.17e2f19b.js" defer></script>
  </body>
</html>
