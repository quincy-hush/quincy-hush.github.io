<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《Effective C++》 | 1ms Faster</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/more.png">
    <meta name="description" content="Software performace profile/analysis/optimization">
    <meta name="keywords" content="optimization, analysis, profile, performance, latency, throughput, metrics, linux, cache, CPU, architecture">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.e5fe63c7.css" as="style"><link rel="preload" href="/assets/js/app.58c04381.js" as="script"><link rel="preload" href="/assets/js/2.0eed2333.js" as="script"><link rel="preload" href="/assets/js/3.1c18827c.js" as="script"><link rel="preload" href="/assets/js/25.6c45a16d.js" as="script"><link rel="prefetch" href="/assets/js/10.20339081.js"><link rel="prefetch" href="/assets/js/11.9e667a20.js"><link rel="prefetch" href="/assets/js/12.e10ed919.js"><link rel="prefetch" href="/assets/js/13.5b153336.js"><link rel="prefetch" href="/assets/js/14.c9818bab.js"><link rel="prefetch" href="/assets/js/15.e1d4e55a.js"><link rel="prefetch" href="/assets/js/16.b5733294.js"><link rel="prefetch" href="/assets/js/17.6ebbc744.js"><link rel="prefetch" href="/assets/js/18.70850c97.js"><link rel="prefetch" href="/assets/js/19.58d5cecb.js"><link rel="prefetch" href="/assets/js/20.8bcfd87e.js"><link rel="prefetch" href="/assets/js/21.b607bcc6.js"><link rel="prefetch" href="/assets/js/22.bbfb5196.js"><link rel="prefetch" href="/assets/js/23.ca136498.js"><link rel="prefetch" href="/assets/js/24.c1071b43.js"><link rel="prefetch" href="/assets/js/26.83d3d99a.js"><link rel="prefetch" href="/assets/js/27.c9eeaa99.js"><link rel="prefetch" href="/assets/js/28.39f64e1d.js"><link rel="prefetch" href="/assets/js/29.dde3b6c9.js"><link rel="prefetch" href="/assets/js/30.fba95149.js"><link rel="prefetch" href="/assets/js/31.d0f1a75b.js"><link rel="prefetch" href="/assets/js/32.d67d090d.js"><link rel="prefetch" href="/assets/js/33.ab0cea95.js"><link rel="prefetch" href="/assets/js/34.aaf5074b.js"><link rel="prefetch" href="/assets/js/4.5c1dc4ce.js"><link rel="prefetch" href="/assets/js/5.d89070b9.js"><link rel="prefetch" href="/assets/js/6.1e60fa96.js"><link rel="prefetch" href="/assets/js/7.77c61ade.js"><link rel="prefetch" href="/assets/js/8.2239e66f.js"><link rel="prefetch" href="/assets/js/9.77bda456.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e5fe63c7.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">1ms Faster</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Wiki" class="dropdown-title"><a href="/wiki/" class="link-title">Wiki</a> <span class="title" style="display:none;">Wiki</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Program</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/lean_in_c++/" class="nav-link">Lean in C++</a></li></ul></li><li class="dropdown-item"><h4>Perfromance Engineering</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/Performance_Engineering/" class="nav-link">[&gt;&gt;&gt;&gt;&gt;]</a></li></ul></li><li class="dropdown-item"><h4>Reading Note</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/Reading_Notes/" class="nav-link">[&gt;&gt;&gt;&gt;&gt;]</a></li></ul></li><li class="dropdown-item"><h4>ComputeArch</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e983dd/404" class="nav-link">[_]</a></li></ul></li><li class="dropdown-item"><h4>Compiler</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e983dd/404" class="nav-link">[_]</a></li></ul></li><li class="dropdown-item"><h4>System</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e983dd/404" class="nav-link">[_]</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/authoring/" class="nav-link">Authoring</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Archives" class="dropdown-title"><a href="/archives/" class="link-title">Archives</a> <span class="title" style="display:none;">Archives</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">Categories</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">Tags</a></li></ul></div></div> <a href="https://github.com/Quincy-J" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/github_profile_2_1.jpg"> <div class="blogger-info"><h3>Quincy Jet</h3> <span>We are.</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Wiki" class="dropdown-title"><a href="/wiki/" class="link-title">Wiki</a> <span class="title" style="display:none;">Wiki</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Program</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/lean_in_c++/" class="nav-link">Lean in C++</a></li></ul></li><li class="dropdown-item"><h4>Perfromance Engineering</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/Performance_Engineering/" class="nav-link">[&gt;&gt;&gt;&gt;&gt;]</a></li></ul></li><li class="dropdown-item"><h4>Reading Note</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/Reading_Notes/" class="nav-link">[&gt;&gt;&gt;&gt;&gt;]</a></li></ul></li><li class="dropdown-item"><h4>ComputeArch</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e983dd/404" class="nav-link">[_]</a></li></ul></li><li class="dropdown-item"><h4>Compiler</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e983dd/404" class="nav-link">[_]</a></li></ul></li><li class="dropdown-item"><h4>System</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e983dd/404" class="nav-link">[_]</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/authoring/" class="nav-link">Authoring</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Archives" class="dropdown-title"><a href="/archives/" class="link-title">Archives</a> <span class="title" style="display:none;">Archives</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">Categories</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">Tags</a></li></ul></div></div> <a href="https://github.com/Quincy-J" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Lean in c++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Performance Engineering</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Misc</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Reading Notes</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e983dd/" aria-current="page" class="active sidebar-link">《Effective C++》</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/e983dd/#习惯c" class="sidebar-link">习惯C++</a></li><li class="sidebar-sub-header level2"><a href="/pages/e983dd/#构造-析构-和重载赋值运算符" class="sidebar-link">构造，析构， 和重载赋值运算符</a></li><li class="sidebar-sub-header level2"><a href="/pages/e983dd/#resource-management-资源管理" class="sidebar-link">Resource Management， 资源管理</a></li><li class="sidebar-sub-header level2"><a href="/pages/e983dd/#design-and-declarations-设计与声明" class="sidebar-link">Design and Declarations, 设计与声明</a></li><li class="sidebar-sub-header level2"><a href="/pages/e983dd/#implementations-实现" class="sidebar-link">Implementations, 实现</a></li><li class="sidebar-sub-header level2"><a href="/pages/e983dd/#继承与面向对象的设计" class="sidebar-link">继承与面向对象的设计</a></li><li class="sidebar-sub-header level2"><a href="/pages/e983dd/#模板-gp" class="sidebar-link">模板，GP</a></li><li class="sidebar-sub-header level2"><a href="/pages/e983dd/#定制new和delete" class="sidebar-link">定制new和delete</a></li><li class="sidebar-sub-header level2"><a href="/pages/e983dd/#一些杂项" class="sidebar-link">一些杂项</a></li></ul></li><li><a href="/pages/ecdb91/" class="sidebar-link">《More Effective C++》</a></li><li><a href="/wiki/Reading_Notes/" class="sidebar-link">《C++ 性能优化指南》</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/wiki/#Wiki" data-v-06970110>Wiki</a></li><li data-v-06970110><a href="/wiki/#Reading Notes" data-v-06970110>Reading Notes</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://github.com/Quincy-J" target="_blank" title="作者" class="beLink" data-v-06970110>Quincy Jet</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2022-06-27</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">Content</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">《Effective C++》<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="effective-c"><a href="#effective-c" class="header-anchor">#</a> Effective C++</h1> <h2 id="习惯c"><a href="#习惯c" class="header-anchor">#</a> 习惯C++</h2> <ol><li><p>C++是一个语言联邦， 有多种编程范式: procedural （面向过程）, OOP（面向对象）， GP（泛型编程）,  Functional Programming（函数式编程），metaprograming(元编程），但差不多有四个主要的部分：</p> <ol><li>C：数组， 指针， 预处理， 程序员的自我修养</li> <li>Object oriented C++： classs, encapsulation, ingeritance, polymorphism,  virtual function的动态绑定；（模板， 异常， 重载）</li> <li>Template C++ (template metaprogramming, 模板元编程)</li> <li>STL： container, iterator, algorithms, function objects</li></ol></li> <li><p>用const， enum， inline来代替 #define</p></li> <li><p>该用const的地方，尽可能使用const</p> <p>函数的参数， 传引用的时候， 使用const修饰， 会明示参数是否被改变（引用不改变， 要加const表示出来）</p> <p>成员函数后是否要加const， 确定成员函数是否会修改类内的值，</p> <p>以及<strong>返回值是否要成为const</strong>（为什么？）， 返回值类型上不允许变动（避免成为左值被修改）</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>a<span class="token punctuation">.</span><span class="token function">get_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>对象在使用之前要初始化</p> <ul><li><p>读取没有初始化的值， 导致不明确的行为， 变量里面包含的内容都是半随机状态</p></li> <li><p>在初始化列表里面， 列出所有的成员变量， 免得遗漏， 除非记得住哪些不用初始值；</p></li> <li><p>成员变量是const或者reference， 就一定要初始化， 因为后面不能再被赋值了；</p></li> <li><p>实在太多的话， 用一个private函数包一下能够赋值处理的， 也可以；</p></li> <li><p>初始化的顺序总是按照声明顺序来， 不是按照初始化列表的顺序</p></li> <li><p>如果有一个外部的static对象， 没有办法保证是否使用的时候已经初始化， 那就在本地搞一个static函数把这个对象包起来，返回一个指向这个对象的reference， 这样， 外部的static对象就变成了本地的static对象， 这也是singleton模式的一个常见实现手法（这种手法叫做reference returning）</p></li> <li><p>和more effective c++里面， 限制对象数目的方式， 好像是一样的<img src="/1_Effective_C++.assets/image-20230525105443119.png" alt="image-20230525105443119"></p></li> <li><p>任何一种non const static 对象，在多线程环境下， 都会有线程安全的问题；</p></li></ul></li></ol> <h2 id="构造-析构-和重载赋值运算符"><a href="#构造-析构-和重载赋值运算符" class="header-anchor">#</a> 构造，析构， 和重载赋值运算符</h2> <ol start="5"><li><p>C++ 自动生成的构造，析构， 拷贝赋值函数（op=重载），(big three, 除此之外还有移动构造， 移动赋值， 不过这需要自己的写）</p> <ol><li><p>默认的构造， 析构函数， 只能是浅复制， 值的复制， 如果有指针， 只能指向同一个地址， 而不能有两份内存出来；</p></li> <li><p>对const成员变量， reference变量， 自动生成的copy assignment是不能对这些东西进行赋值和拷贝操作的</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">Timekeeper</span><span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Timekeeper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">TimeKeeper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>经验： class里面如果有一个virtual的函数， 就为这个类弄一个virtual的析构函数；</p></li> <li><p>纯虚函数？纯虚函数会带来一个抽象基类， 抽象基类不能实例化；但是抽象基类也可以有一个纯虚的析构函数，需要单独提供一份定义；</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">AWOV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">AWOV</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">AMOV</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">AMOV</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token comment">// 单独提供一份定义</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol></li> <li><p>如何拒绝使用这些自动生成的函数，</p> <ol><li>使用=delete来禁止使用拷贝构造， 拷贝赋值，</li> <li>以前在没有=delete关键字的时候， 可以把这些函数放在private里面</li></ol></li> <li><p>多态基类的析构函数最好弄成virtual的；</p> <ol><li>如果析构函数不是virtual的， 那么delete基类指针来进行析构的话。derived部分偶尔会被遗漏掉；</li> <li>为什么不是构造函数？因为我们构造的时候， 基本上都是用derived类来进行构造的；</li></ol></li> <li><p>析构函数不要吐出异常（别让异常逃离析构函数）, <strong>为什么?</strong></p> <ol><li>如果不处理异常， 会带来一些不明确的行为</li> <li>如果吐出异常，可能会导致程序半路断掉；</li> <li>所以要好好善后；</li></ol></li> <li><p>析构和构造函数中， 不要调用virtual函数， <strong>为什么?</strong></p> <ol><li>构造的时候， derived对象还没有生成， 所以这个时候还用不到自身特化的virtual function， 只能用base class里面的版本；</li> <li>析构的时候， 只要一开始析构， 对象内的derived class成员变量就是未定义值， 所以这个时候virtual function还是会跑到父类里面去；</li></ol></li> <li><p>operator= 最好是返回一个 reference to *this,</p> <ol><li>因为这样可以拥有连续赋值的特性， 例如： x = y = z = 15</li></ol></li> <li><p>operator=里面， 要判断是否是自我赋值；</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>Widget<span class="token operator">&amp;</span> Widget<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Widget<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token keyword">delete</span> pb<span class="token punctuation">;</span>
	pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Bitmap</span><span class="token punctuation">(</span><span class="token operator">*</span>rhs<span class="token punctuation">.</span>pb<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">*</span>rhs<span class="token punctuation">;</span>	
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>自定义拷贝构造函数的时候， 要复制所有local的变量， 可以使用基类的一些拷贝构造函数对一些成员拷贝；</p> <p>因为有一些基类对象的拷贝， 必须要通过基类的拷贝构造函数来进行深度拷贝；</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>PriorityCustomer<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> PriorityCustomer <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">logCall</span><span class="token punctuation">(</span><span class="token string">&quot;......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Customer<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>rhs<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里直接调用了base class的拷贝构造函数来进行；</span>
    priority <span class="token operator">=</span> rhs<span class="token punctuation">.</span>priority<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>不要使用copy assignment 来调用copy constructor; 反过来也不建议， 因为都是针对没有构造好的对象进行操作；</p> <p>最终还是要将他么共同的一些实际操作放到函数里面， 因为只要使用上面两种函数， 都会要实现构造一个临时的对象， 但对象在这些函数运行过程中都是没有构造好的；</p></li></ol> <h2 id="resource-management-资源管理"><a href="#resource-management-资源管理" class="header-anchor">#</a> Resource Management， 资源管理</h2> <ol start="13"><li><p>用对象的形式管理资源 (RAII， Resource Acquisition Is Initialization)，所以要特别注意构造和析构函数，在使用对象的时候可以使用shared_ptr之类的智能指针来管理每个对象的实例；</p> <ol><li>返回没有加工的指针， 容易造成资源泄露， 忘记delete</li> <li>手动释放资源， 可能会跑不到释放的那个地方， 也有可能造成double release；</li> <li>不要多个auto_ptr()指向同一个对象， 不然对象可能会被多次删除， 程序就会有未定义行为；</li> <li>copy assignment要让原来的指针变成null</li> <li>使用reference counting smart pointer, 使用<strong>shared_ptr()</strong></li></ol></li> <li><p>虽然都是RAII原则， 但是要特别注意拷贝构造的行为，书里面用linux中的mutex的lock和unlock函数来举了例子</p> <ol><li>要清楚自己做的是深拷贝还是浅拷贝，要确保自己是在做深拷贝， 不仅拷贝指针， 也拷贝指针所指的内存块；</li> <li>有时候拷贝其实是一种转移， 要确保系统中给目前只有者一个对象， 从一个地方转移到另外一个地方--&gt; auto_ptr</li> <li>自动生成的拷贝函数不一定能够满足需求；</li></ol></li> <li><p>资源管理类中， 提供对原始资源的访问接口， 例如x.get， get_instance这种接口</p> <ol><li><p>返回数字，</p></li> <li><p>返回一个instance</p></li> <li><p>singleton的设计模式是怎么做的?</p></li> <li><p>factory模式是怎么做的？</p></li> <li><p>操作符重载</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">Font</span><span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">operator</span> <span class="token function">FontHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token comment">//也可以重载类型转换函数；</span>
    	<span class="token keyword">return</span> f<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol></li> <li><p>new和delete使用的时候要成对使用， 并且注意区别数组和对象的delete</p> <ul><li>operator new, new operator的区别？</li> <li>placement new / new placement区别？</li></ul> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>string<span class="token operator">*</span> stringPtr1 <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>string<span class="token operator">*</span> stringPtr2 <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">delete</span> stringPtr1<span class="token punctuation">;</span> <span class="token comment">// 删除一个对象， 一个指针；</span>
<span class="token keyword">delete</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> stringPtr2<span class="token punctuation">;</span> <span class="token comment">// 删除一个数组， 一块内存</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>以单独的一条语句把new出来的对象放到智能指针里面去， why?</p> <ol><li><p>要保证new这个语句是单独执行的， 先于智能指针的赋值操作；</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token function">processWidget</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>tr1<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">shared_ptr</span><span class="token generic class-name"><span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> Widget<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">priority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 万一priority()这个函数执行异常会怎样？</span>

std<span class="token double-colon punctuation">::</span>tr1<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span> <span class="token function">pw</span><span class="token punctuation">(</span><span class="token keyword">new</span> Widget<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">processWidget</span><span class="token punctuation">(</span>pw<span class="token punctuation">,</span> <span class="token function">priority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ol></li></ol> <h2 id="design-and-declarations-设计与声明"><a href="#design-and-declarations-设计与声明" class="header-anchor">#</a> Design and Declarations, 设计与声明</h2> <ol start="18"><li><p>接口设计简明， 不要让用户对其有歧义</p> <ol><li>建立新类型，限制类型上的操作， 束缚对象值，消除客户的资源管理责任</li> <li>好好设计程序的类型系统， 使用class， template， typedef， struct， enum等等</li></ol></li> <li><p><strong>设计class的时候， 就好比设计type（一系列要注意的事项）</strong></p> <ul><li>如何创建和销毁， operator new, operator new[]. operator delete, operator delete[],</li> <li>对象初始化和对象的赋值有什么区别？ 拷贝构造， 和copy assignment之间有什么区别？ 。</li></ul></li></ol> <p>对一个新对象来说， pass by value意味着什么？因为要重载操作符， 函数， 和重载内存的分配和归还，</p> <p>type cast的我呢提要怎么处理， 类型转换函数， operator T</p> <ol start="20"><li><p>函数的参数使用pass by reference to const替换pass by value，（内置类型， 其实pass by value也比较合适）</p> <ol><li>效率会比较高</li></ol></li> <li><p>如果必须返回一个对象，  不要返回他的reference，</p> <ol><li>因为可能会返回一个local的对象，local对象的renference是没有用的；</li></ol></li> <li><p>成员变量声明为private</p> <ol><li>使用函数来对成员变量进行访问控制， 这样能够给类更好的封装性</li></ol></li> <li><p>使用non member, non friend来替换member函数</p> <ol><li>为的是增加封装性， 增加扩充的弹性，</li> <li>可以把全局函数放在一个命名空间里面， 稍微约束一下它的作用域</li></ol></li> <li><p><strong>如果某个函数所有的参数都需要类型转换， 这个函数必须弄成non merber函数</strong></p> <ol><li>【不是很懂， 需要接触一下模板相关的知识？】</li></ol></li> <li><p>给自己的类写的swap函数，不要抛出异常， 这是为了和STL库一样支持swap的异常安全；</p> <ol><li>friend可以方位private变量和函数；</li></ol></li></ol> <h2 id="implementations-实现"><a href="#implementations-实现" class="header-anchor">#</a> Implementations, 实现</h2> <ol start="26"><li><p>延迟变量定义的出现时间， 尽量<strong>用到的时候再定义；</strong></p></li> <li><p>少做cast转型动作， 即使要用也尽量使用C++自己的那四个转型</p> <ul><li><p>static_cast</p></li> <li><p>const_cast</p></li> <li><p>dynamic_cast</p></li> <li><p>reinterpret_cast</p></li></ul></li> <li><p>避免返回一个handler， 这个handler却有指向对象的内部成分，</p> <ol><li>避免返回的是一个空悬的指针；</li> <li>避免可以使用调用的操作来对函数内部的元素进行修改， 可以指定返回值是一个const， 这样用户就不能修改了；</li></ol></li> <li><p>注意异常安全， （exceptional C++里面有很多异常安全的相关介绍）</p></li> <li><p>对inline的里里外外需要透彻了解；</p></li></ol> <ul><li><p>尽量inline， 也许compiler就能够执行context相关的inline优化；</p></li> <li><p>定义在类里面的函数， 自动inline</p></li> <li><p>inline会让代码文件变大， 会导致更多的换页行为（paging），降低 i cache的命中率, 如果函数比较小， inline对 icache miss的影响会稍微比较小， 但是inline的函数比较大， 就有可能会得不偿失；</p></li> <li><p>虚函数的inline， 大多都不会生效</p></li> <li><p>inline不仅会导致代码变大， 而且一旦inline的函数发生改变， 所有用到inline function的地方都要重新编译</p></li> <li><p>template要尽量避免成为一个inline函数， 它的代价是很大的；</p></li></ul> <ol start="31"><li>尽量减少文件之间的编译依赖关系；不然修改之后编译， 会导致很多部件都一起编译了</li></ol> <ul><li>头文件应该仅有声明不要有定义；</li> <li>一般使用pointer to implementation 和纯虚函数的工厂方法来解决， 前者叫handle class, 后者叫interface class;</li></ul> <h2 id="继承与面向对象的设计"><a href="#继承与面向对象的设计" class="header-anchor">#</a> 继承与面向对象的设计</h2> <ol start="32"><li>public继承的时候， 确认两个对象是 is a的关系；</li> <li>继承的时候，注意类内部的变量名称是否会被覆盖，</li></ol> <ul><li>即使是重载的函数，不管函数接口形式是否一样， 也会被子类的同名函数覆盖</li> <li>使用using Base::mf3() 可以指定在子类作用域范围里面使用base类的mf3函数，</li> <li>如果只想使用某一个mf3(), 只能是子类的函数里面， 再调用Base::mf3(); 美其名曰，forward functions;</li></ul> <ol start="34"><li><p>什么是接口继承和实现继承？</p> <ol><li>pure virtual函数的目的就是接口继承， 但是也可以有一份基类实现，调用的时候只能通过子类指定父类名称的方式来调用（纯虚函数必须重写）；</li> <li>非纯虚函数是为了让子类继承接口 + 缺省实现， 这些都是自动继承的， 如果子类不override 虚函数的话（一般虚函数可以重写， 也可以不重写）；</li> <li>非虚函数的目的是强制让子类继承一个缺省的实现；（非虚函数，没有多态性，直接继承）</li> <li>接口和实现继承分开， 也就是把接口用一个纯虚函数来声明， 实现使用一个private或者protected的缺省实现来代替， 这样子类必须要重写纯虚函数，但是可以选择使用缺省的实现；</li> <li>也可以使用一个虚函数的非虚实现， 然后再在子类里面overide的时候调用这个函数；</li></ol></li> <li><p>除了virtual函数之外，也可以考虑一下其他的选择</p> <ol><li>通过一个public函数， 调用自己的virtual函数， non-virtual interface（NVI）方法；（模板方法设计模式）</li> <li>借助funciion pointer实现strategy pattern</li> <li>使用各个库里面的function component， 例如std::function， 而且这个东西支持任何callable entities，包括运算符重载的struct和class</li> <li>标准设计模式， 古典的strategy模式， 就是使用pImple的方式来实现strategy， 来代替第一条里面的实现方式</li></ol></li> <li><p>不要重新定义继承来的non virtual函数， 这其实是一种overloading， 并不能实现多态特性的overide， nonvirtual 函数其实是静态绑定的；virtual函数是动态绑定的</p></li> <li><p>不要重新定义继承来的缺省参数值， 因为可能会在调用子类的时候， 用到父类里面这个函数的默认值，（对于通过对象指针， 引用的方式都会有这个问题， 因为默认参数的绑定，是一种静态绑定），子类就声明参数就可以了， 不需要有默认值</p></li> <li><p>通过composition实现has a, 或者根据某物实现的关系</p></li> <li><p>谨慎使用private继承，</p> <ol><li>编译器不会把一个private继承的子类，自动转换成一个基类</li> <li>private继承下来的所有成员， 在子类中都会变成private属性</li> <li>protect继承
<ol><li>默认的基本上都是public继承；</li> <li>尽可能使用compiosition， 必要的时候再使用private继承</li></ol></li></ol></li> <li><p>谨慎使用多重继承（子类从多个父类继承而来）</p> <ol><li>可能对导致对基类函数调用的歧义，到底调用的是哪一个基类的成员函数？</li> <li>钻石形继承， 二级基类可以是虚基类， 这样三级再继承的时候， 就不会重复出现两个爷爷类里面的成员函数了；</li> <li>virtual继承会带来更多大小，速度，初始化的成本。如果非要有一个virtual base class， 最好不要在虚基类里面放置数据；</li> <li>有一种情况， 比较适合多重继承，public继承某个interface class， private继承某个协助实现的class；帮助子类实现某些功能。但是还是谨记第一条吧；</li></ol></li></ol> <h2 id="模板-gp"><a href="#模板-gp" class="header-anchor">#</a> 模板，GP</h2> <ol start="41"><li>隐式接口和编译期多态</li> <li>typename和class关键字， typename关键字的双重定义</li> <li>如何处理模板化基类的里面的名称</li> <li>参数无关的代码， 抽离template</li> <li>使用成员函数模板来接受所有兼容的类型</li> <li>需要类型转换的时候， 为模板定义一个非成员函数</li> <li>使用traits来表现模板里面的类型信息</li> <li>什么是template元编程</li></ol> <h2 id="定制new和delete"><a href="#定制new和delete" class="header-anchor">#</a> 定制new和delete</h2> <ol start="49"><li>new handler的行为（处理new失败时候throw的异常）， 底层是怎样构成的？</li> <li>operator new和operator delete的合理替换时机；</li> <li>operator new和operator delete需要遵循的一些规则</li> <li>placement new和placement delete</li></ol> <h2 id="一些杂项"><a href="#一些杂项" class="header-anchor">#</a> 一些杂项</h2> <ol start="53"><li>编译器的warnning有时候也很重要</li> <li>熟悉TR1标准库</li> <li>熟悉boost保准库</li></ol></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">Last updated:</span> <span class="time">2023/06/18, 16:23:56</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/6f0fa2/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">VsCode 常用插件</div></a> <a href="/pages/ecdb91/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">《More Effective C++》</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/6f0fa2/" class="prev">VsCode 常用插件</a></span> <span class="next"><a href="/pages/ecdb91/">《More Effective C++》</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:quincy_jet@outlook.com" title="E-Mail" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Quincy-J" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
    Copyright © 2017-2023
    <span>Quincy Jet | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          Auto 
        </li><li class="iconfont icon-rijianmoshi">
          Light 
        </li><li class="iconfont icon-yejianmoshi">
          Dark 
        </li><li class="iconfont icon-yuedu">
          Read
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.58c04381.js" defer></script><script src="/assets/js/2.0eed2333.js" defer></script><script src="/assets/js/3.1c18827c.js" defer></script><script src="/assets/js/25.6c45a16d.js" defer></script>
  </body>
</html>
